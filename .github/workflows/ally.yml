name: Accessibility

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  pa11y:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20

      # Install the CLI
      - run: npm i -g pa11y-ci

      # Run Pa11y against URLs in .pa11yci.json
      # 1) produce a JSON report artifact
      # 2) allow the build to pass for now while you fix issues
      - name: Run Pa11y
        run: |
          pa11y-ci --json > a11y-report.json || echo "PA11Y_FAILED=1" >> $GITHUB_ENV

      - name: Upload Pa11y report
        uses: actions/upload-artifact@v4
        with:
          name: a11y-report
          path: a11y-report.json

      # If you want the build to fail when issues exist, switch 'if:' to always()
      # and add 'exit 1' when PA11Y_FAILED is set.
      - name: Mark job as failed if Pa11y found issues (optional)
        if: env.PA11Y_FAILED == '1'
        run: |
          echo "::warning::Pa11y found accessibility issues. See a11y-report.json artifact."
          # exit 1   # <-- uncomment later to make failures block merges